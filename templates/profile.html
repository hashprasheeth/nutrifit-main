{% extends "base.html" %}

{% block title %}Profile - NutriFy{% endblock %}

{% block content %}
<div class="profile-layout">
    <div class="dashboard-header dashboard-layout-wide">
        <h1 class="dashboard-title slide-in-up">Your Profile</h1>
        <div class="dashboard-actions">
            <button form="profile-form" type="submit" class="btn btn-primary">Save Profile</button>
        </div>
    </div>
    
    <div class="profile-sidebar slide-in-up" style="animation-delay: 0.1s;">
        <div class="profile-header">
            <div class="avatar avatar-lg bg-accent-green-light text-accent-green">
                {{ current_user.email[0] | upper }}
            </div>
            <h3 class="profile-name text-white">{{ user_profile.name if user_profile and user_profile.name else current_user.email }}</h3>
            <p class="profile-email text-white opacity-70">{{ current_user.email }}</p>
        </div>
        
        {% if user_profile and user_profile.height and user_profile.weight %}
        <div class="mt-6 pt-6 border-t border-dark-border">
            <h4 class="text-lg font-semibold mb-2 text-white">Body Stats</h4>
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center">
                    <div class="text-xl font-bold text-white">{{ user_profile.height }} cm</div>
                    <div class="text-sm text-white opacity-70">Height</div>
                </div>
                <div class="text-center">
                    <div class="text-xl font-bold text-white">{{ user_profile.weight }} kg</div>
                    <div class="text-sm text-white opacity-70">Weight</div>
                </div>
            </div>
            
            <div id="bmi-result" class="mt-4 p-4 rounded-lg bg-dark-card-highlight">
                <div class="text-center mb-1 text-white opacity-80">Your BMI</div>
                <div id="bmi-value" class="text-2xl font-bold text-center text-white">{{ bmi if bmi else '' }}</div>
                <div id="bmi-category" class="text-sm text-center {{ bmi_category if bmi_category else '' }}">{{ bmi_message if bmi_message else '' }}</div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="profile-content slide-in-up" style="animation-delay: 0.2s;">
        <form id="profile-form" class="grid gap-6" method="POST" action="{{ url_for('profile') }}">
            <div class="card shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Personal Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="name" class="form-label text-white">Name</label>
                        <input type="text" id="name" name="name" class="form-control" value="{{ user_profile.name if user_profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="age" class="form-label text-white">Age</label>
                        <input type="number" id="age" name="age" min="15" max="120" class="form-control" value="{{ user_profile.age if user_profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="gender" class="form-label text-white">Gender</label>
                        <select id="gender" name="gender" class="form-control">
                            <option value="">Select</option>
                            <option value="male" {{ 'selected' if user_profile and user_profile.gender == 'male' else '' }}>Male</option>
                            <option value="female" {{ 'selected' if user_profile and user_profile.gender == 'female' else '' }}>Female</option>
                            <option value="other" {{ 'selected' if user_profile and user_profile.gender == 'other' else '' }}>Other</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="card shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Body Metrics</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="height" class="form-label text-white">Height (cm)</label>
                        <input type="number" id="height" name="height" min="100" max="250" step="0.1" class="form-control" value="{{ user_profile.height if user_profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="weight" class="form-label text-white">Weight (kg)</label>
                        <input type="number" id="weight" name="weight" min="30" max="300" step="0.1" class="form-control" value="{{ user_profile.weight if user_profile else '' }}">
                    </div>
                </div>
            </div>
            
            <div class="card shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Activity & Goals</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="activity_level" class="form-label text-white">Activity Level</label>
                        <select id="activity_level" name="activity_level" class="form-control">
                            <option value="">Select</option>
                            <option value="sedentary" {{ 'selected' if user_profile and user_profile.activity_level == 'sedentary' else '' }}>Sedentary (little or no exercise)</option>
                            <option value="light" {{ 'selected' if user_profile and user_profile.activity_level == 'light' else '' }}>Lightly active (light exercise 1-3 days/week)</option>
                            <option value="moderate" {{ 'selected' if user_profile and user_profile.activity_level == 'moderate' else '' }}>Moderately active (moderate exercise 3-5 days/week)</option>
                            <option value="active" {{ 'selected' if user_profile and user_profile.activity_level == 'active' else '' }}>Active (hard exercise 6-7 days/week)</option>
                            <option value="very_active" {{ 'selected' if user_profile and user_profile.activity_level == 'very_active' else '' }}>Very active (very hard exercise & physical job)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="goal" class="form-label text-white">Fitness Goal</label>
                        <select id="goal" name="goal" class="form-control">
                            <option value="">Select</option>
                            <option value="lose_weight" {{ 'selected' if user_profile and user_profile.goal == 'lose_weight' else '' }}>Lose Weight</option>
                            <option value="maintain" {{ 'selected' if user_profile and user_profile.goal == 'maintain' else '' }}>Maintain Weight</option>
                            <option value="gain_muscle" {{ 'selected' if user_profile and user_profile.goal == 'gain_muscle' else '' }}>Gain Muscle</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="card shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Dietary Preferences</h2>
                <div class="form-group">
                    <label for="dietary_restrictions" class="form-label text-white">Dietary Restrictions</label>
                    <select id="dietary_restrictions" name="dietary_restrictions" class="form-control">
                        <option value="none" {{ 'selected' if user_profile and user_profile.dietary_restrictions == 'none' else '' }}>None</option>
                        <option value="vegetarian" {{ 'selected' if user_profile and user_profile.dietary_restrictions == 'vegetarian' else '' }}>Vegetarian</option>
                        <option value="vegan" {{ 'selected' if user_profile and user_profile.dietary_restrictions == 'vegan' else '' }}>Vegan</option>
                        <option value="pescatarian" {{ 'selected' if user_profile and user_profile.dietary_restrictions == 'pescatarian' else '' }}>Pescatarian</option>
                        <option value="gluten_free" {{ 'selected' if user_profile and user_profile.dietary_restrictions == 'gluten_free' else '' }}>Gluten-Free</option>
                        <option value="dairy_free" {{ 'selected' if user_profile and user_profile.dietary_restrictions == 'dairy_free' else '' }}>Dairy-Free</option>
                    </select>
                </div>
            </div>
            
            <div class="card shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Nutrition Goals</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="daily_calorie_goal" class="form-label text-white">Daily Calories (kcal)</label>
                        <input type="number" id="daily_calorie_goal" name="daily_calorie_goal" min="1000" max="5000" class="form-control" value="{{ user_profile.daily_calorie_goal if user_profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="daily_protein_goal" class="form-label text-white">Protein Goal (g)</label>
                        <input type="number" id="daily_protein_goal" name="daily_protein_goal" min="20" max="300" class="form-control" value="{{ user_profile.daily_protein_goal if user_profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="daily_carbs_goal" class="form-label text-white">Carbs Goal (g)</label>
                        <input type="number" id="daily_carbs_goal" name="daily_carbs_goal" min="50" max="500" class="form-control" value="{{ user_profile.daily_carbs_goal if user_profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="daily_fat_goal" class="form-label text-white">Fat Goal (g)</label>
                        <input type="number" id="daily_fat_goal" name="daily_fat_goal" min="20" max="200" class="form-control" value="{{ user_profile.daily_fat_goal if user_profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="daily_water_goal" class="form-label text-white">Water Goal (ml)</label>
                        <input type="number" id="daily_water_goal" name="daily_water_goal" min="500" max="5000" step="100" class="form-control" value="{{ user_profile.daily_water_goal if user_profile else '' }}">
                    </div>
                </div>
                <div class="mt-4 text-sm text-white opacity-70">
                    <p>Leave fields blank to use auto-calculated values based on your profile information.</p>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
.profile-sidebar {
    background-color: var(--dark-card-bg);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.profile-content .card {
    background-color: var(--dark-card-bg);
    border-radius: 16px;
    border: none;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 32px;
    margin: 0 auto 16px;
}

.profile-header {
    text-align: center;
    margin-bottom: 24px;
}

.profile-name {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 4px;
}

.form-control {
    background-color: var(--dark-card-highlight);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    width: 100%;
    transition: all 0.2s ease;
}

.form-control:focus {
    border-color: var(--accent-green);
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
    outline: none;
}

.form-label {
    margin-bottom: 0.5rem;
    display: block;
}

/* Update text classes for BMI categories */
.text-success {
    color: var(--accent-green) !important;
}

.text-warning {
    color: var(--accent-yellow) !important;
}

.text-danger {
    color: var(--accent-red) !important;
}

.text-info {
    color: var(--accent-blue) !important;
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const heightInput = document.getElementById('height');
    const weightInput = document.getElementById('weight');
    const bmiResult = document.getElementById('bmi-result');
    const bmiValue = document.getElementById('bmi-value');
    const bmiCategory = document.getElementById('bmi-category');
    
    function calculateBMI() {
        if (heightInput.value && weightInput.value) {
            const height = parseFloat(heightInput.value) / 100; // Convert cm to m
            const weight = parseFloat(weightInput.value);
            
            if (height > 0 && weight > 0) {
                const bmi = (weight / (height * height)).toFixed(1);
                bmiValue.textContent = bmi;
                
                let category = '';
                let message = '';
                
                // Remove any existing category classes
                bmiCategory.classList.remove('text-success', 'text-warning', 'text-danger', 'text-info');
                
                if (bmi < 18.5) {
                    category = 'text-info';
                    message = 'Underweight - Consider increasing calorie intake.';
                } else if (bmi >= 18.5 && bmi < 25) {
                    category = 'text-success';
                    message = 'Normal weight - Maintain your healthy habits!';
                } else if (bmi >= 25 && bmi < 30) {
                    category = 'text-warning';
                    message = 'Overweight - Consider a balanced diet and regular exercise.';
                } else {
                    category = 'text-danger';
                    message = 'Obese - Consult with a healthcare professional for guidance.';
                }
                
                bmiCategory.textContent = message;
                bmiCategory.classList.add(category);
                
                // Add animation
                bmiResult.classList.add('scale-effect');
                setTimeout(() => {
                    bmiResult.classList.remove('scale-effect');
                }, 500);
            }
        }
    }
    
    // Calculate BMI on input change
    if (heightInput && weightInput) {
        heightInput.addEventListener('input', calculateBMI);
        weightInput.addEventListener('input', calculateBMI);
    }
});
</script>
{% endblock %} 